<!doctype html>
<html>
<head>
<title>Open Government</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="generator" content="Polymer Starter Kit" />
    <meta charset="utf-8">
  <!-- build:js bower_components/webcomponentsjs/webcomponents-lite.min.js -->
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <!-- endbuild -->

  <!-- will be replaced with elements/elements.vulcanized.html -->
  <link rel="import" href="elements/elements.html">
  <!-- endreplace-->

</head>
<body class="fullbleed layout vertical">
<script>
    (function (document) {
        'use strict';

        var app = document.querySelector('#app');

        window.addEventListener('WebComponentsReady', function() {
            var ironAjax = document.querySelector('iron-ajax');
            ironAjax.addEventListener('response', function(e) {
                if (this.params.pageIdx === 1){
                    document.querySelector("#SearchResult2").innerHTML='';
                }
                if ( document.querySelector('#pending') != null
                    && ironAjax.activeRequests != null){
                    document.querySelector('#pending').innerHTML=
                    ironAjax.activeRequests.length  + ' progress: ('+ 
                    (this.lastResponse.response.metadata.totalresults
                    -ironAjax.activeRequests.length)  + ' of ' + 
                    this.lastResponse.response.metadata.totalresults + ') ';
                }

                if( e.detail.response != null){

                var document_body = document.querySelector("#SearchResult2");
                    if(true && document_body != null){ 
                    document_body.appendChild( document.createElement("hr")); 
                    var div=document.createElement("div"); 
                    div.innerHTML='<b><a href="'+e.detail.xhr.responseURL+'">'+
                    e.detail.xhr.responseURL+'</a></b>';
                    //document_body.appendChild( div ); 
                    }
                for(var i=0; i < e.detail.response.response.results.length; i++){
                    if(true && document_body != null){ 
                    var div=document.createElement("div"); 
                    var fulltext='';
                    var title='';
                    var sponsor='';
                    var active=false;
                    var actions='';
                    var actclause='';
                    if(e.detail.response.response.results[i].otype==='bill'){
                    //console.log( e.detail.response.response.results[i].data); 
                    fulltext= e.detail.response.response.results[i].data.bill.fulltext;
                    title= e.detail.response.response.results[i].data.bill.title;
                    sponsor= JSON.stringify(e.detail.response.response.results[i].data.bill.sponsor);
                    active = e.detail.response.response.results[i].data.bill.active;

                    actions= JSON.stringify(e.detail.response.response.results[i].data.bill.actions);
                    actions='';
                    for(var j=0; j < e.detail.response.response.results[i].data.bill.actions.length; j++){
                    actions += 
                     //JSON.stringify(e.detail.response.response.results[i].data.bill.actions[j]);
                     '<br>' +new Date(parseInt(e.detail.response.response.results[i].data.bill.actions[j].date)) +
                     ' ' + e.detail.response.response.results[i].data.bill.actions[j].text 
                     ;
                    }


                    actclause = e.detail.response.response.results[i].data.bill.actClause;
                    } else {
                    title = 'other: ' + e.detail.response.response.results[i].otype;
                    }
                    div.innerHTML='<br>'+
                    '<paper-header-panel class="flex"><div class="paper-header">' +
                    '<b>Title:</b>&nbsp;' + title + '<br>'+
                    '<b>Sponsor(s):</b>&nbsp;' + sponsor + '<br>' +
                    '<b>Action(s):</b>&nbsp;' + actions + '<br>' +
                    '<b>Active:</b>&nbsp;' + active + '<br>' +
                    '<b>Act Clause:</b>&nbsp;' + actclause + '<br>' +
                    '<b>Link:</b>&nbsp;<a href="' + e.detail.response.response.results[i].url + '">' +
                     e.detail.response.response.results[i].url + '</a><br>' +
                    '</div></paper-header-panel>' + 
                    '<paper-material evalation="2">' + fulltext + '</paper-material>'
                    ;
                    document_body.appendChild( div ); 

                    }
                }
                }

                if (this.params.pageIdx === 1){
                while (++this.params.pageIdx <= this.lastResponse.response.metadata.totalresults){
ironAjax.generateRequest();
                }
                }
            });
            //ironAjax.generateRequest();
        });

    })(document);

</script>


  <template is="dom-bind" id="app">
    <opengov-ny></opengov-ny>

    <paper-toast id="caching-complete"
                 duration="6000"
                 text="Caching complete! This app will work offline.">
    </paper-toast>

    <platinum-sw-register auto-register
                          clients-claim
                          skip-waiting
                          on-service-worker-installed="displayInstalledToast">
      <platinum-sw-cache default-cache-strategy="fastest"
                         precache-file="precache.json">
      </platinum-sw-cache>
    </platinum-sw-register>
  </template>


  <!-- build:js scripts/app.js -->
  <script src="scripts/app.js"></script>
  <!-- endbuild-->
</body>
</html>
